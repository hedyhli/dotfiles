#!/usr/bin/env fish

# Stubbornly translates ~/.exportenvs to ~/.exportenvs.fish

echo "" > ~/.exportenvs.fish # clear the file

for fileline in (cat ~/.exportenvs | sed 's/#!.\+$/#!\/usr\/bin\/env fish/')
    set line (echo "$fileline" | sed 's/export //' | sed 's/#.\+//')
    if test -z "$line"
        echo "Adding '$fileline' as-is"
        echo "$fileline" >> ~/.exportenvs.fish
        continue
    end
    set name (echo "$line" | sed 's/=.\+$//' | sed 's/^$//')
    set content (echo "$line" | sed 's/^.\+=//' | sed 's/\$(/(/')
    echo "Adding $name with $content"
    echo set -x "$name" $content >> ~/.exportenvs.fish
end
